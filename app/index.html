<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ - KitabiAI Digital Library</title>
    <style>
        :root {
            --bg-primary: #F5F3F7;
            --bg-secondary: #FFFFFF;
            --text-primary: #1F2937;
            --text-secondary: #6B7280;
            --accent: #7C3AED;
            --accent-light: #A78BFA;
            --border: #E5E7EB;
            --success: #10B981;
            --warning: #F59E0B;


            
        }

        [data-theme="dark"] {
            --bg-primary: #1A1625;
            --bg-secondary: #2D1B3D;
            --text-primary: #F9FAFB;
            --text-secondary: #D1D5DB;
            --accent: #A78BFA;
            --accent-light: #7C3AED;
            --border: #3D2952;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif, 'Arabic Typesetting';
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            line-height: 1.6;
        }

        /* Header */
        header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: var(--accent-light);
            transform: translateY(-2px);
        }

        .lang-switch {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .lang-switch:hover {
            border-color: var(--accent);
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 3rem 2rem;
            max-width: 900px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
            font-weight: 700;
        }

        .hero p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .search-box {
            width: 100%;
            max-width: 600px;
            margin: 0 auto 2rem;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 1rem 3rem 1rem 1.5rem;
            border: 2px solid var(--border);
            border-radius: 50px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        /* Stats Section */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(124, 58, 237, 0.1);
        }

        .stat-card h3 {
            font-size: 2.5rem;
            color: var(--accent);
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .stat-card p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .stat-card .badge {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            margin-top: 0.5rem;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 2rem;
            color: var(--text-primary);
            font-weight: 700;
        }

        .view-all {
            color: var(--accent);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }

        .view-all:hover {
            color: var(--accent-light);
        }

        /* Filters */
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .filter-btn {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .filter-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .filter-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .filter-btn.coming-soon {
            opacity: 0.5;
            cursor: not-allowed;
            position: relative;
        }

        .filter-btn.coming-soon:after {
            content: ' (Ù‚Ø±ÙŠØ¨Ø§Ù‹)';
            font-size: 0.75rem;
        }

        /* Book Grid */
        .book-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .book-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
        }

        .book-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(124, 58, 237, 0.2);
            border-color: var(--accent);
        }

        .book-cover {
            width: 100%;
            height: 320px;
            background: linear-gradient(135deg, var(--accent-light), var(--accent));
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .book-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .book-cover .placeholder {
            font-size: 4rem;
        }

        .book-info {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .book-card h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 700;
            line-height: 1.4;
            min-height: 2.8rem;
        }

        .book-meta {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
        }

        .book-meta .author {
            font-weight: 600;
            color: var(--accent);
        }

        .book-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: auto;
        }

        .tag {
            background: var(--bg-primary);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }

        .tag.language {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 4rem 2rem;
        }

        .spinner {
            border: 4px solid var(--border);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }

            .stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .book-grid {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                width: 100%;
            }

            .filter-btn {
                flex: 1;
                text-align: center;
            }
        }

        /* RTL Support */
        [dir="rtl"] .search-icon {
            left: auto;
            right: 1.5rem;
        }

        [dir="rtl"] .book-meta {
            text-align: right;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">
            <span>ğŸ“š</span>
            <span>Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</span>
        </div>
        <div class="header-actions">
            <button class="lang-switch" onclick="toggleLanguage()">English</button>
            <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</button>
        </div>
    </header>

    <!-- Hero Section -->
    <div class="hero">
        <h1>Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</h1>
        <p>Ù…ÙƒØªØ¨Ø© Ø±Ù‚Ù…ÙŠØ© Ù„Ù„ÙƒØªØ¨ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©ØŒ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙˆØµÙˆÙ„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</p>

        <div class="search-box">
            <span class="search-icon">ğŸ”</span>
            <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒØªØ¨ØŒ Ù…Ø¤Ù„ÙÙŠÙ†ØŒ Ù…ÙˆØ§Ø¶ÙŠØ¹..." onkeyup="handleSearch()">
        </div>
    </div>

    <!-- Stats -->
    <div class="stats" id="statsContainer">
        <div class="stat-card">
            <h3 id="totalBooks">-</h3>
            <p>ÙƒØªØ§Ø¨</p>
        </div>
        <div class="stat-card">
            <h3 id="arabicBooks">-</h3>
            <p>ÙƒØªØ¨ Ø¹Ø±Ø¨ÙŠØ©</p>
            <span class="badge">Ù…ØªØ§Ø­</span>
        </div>
        <div class="stat-card">
            <h3 id="totalPages">-</h3>
            <p>ØµÙØ­Ø©</p>
        </div>
        <div class="stat-card">
            <h3 id="totalAuthors">-</h3>
            <p>Ù…Ø¤Ù„Ù</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Filters -->
        <div class="section-header">
            <h2 class="section-title">ğŸ“š ØªØµÙØ­ Ø§Ù„Ù…ÙƒØªØ¨Ø©</h2>
        </div>

        <div class="filters">
            <div class="filter-group">
                <button class="filter-btn active" onclick="filterByLanguage('ar')">ğŸ‡¸ğŸ‡¦ Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
                <button class="filter-btn coming-soon" onclick="filterByLanguage('en')" disabled>ğŸ‡¬ğŸ‡§ Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</button>
                <button class="filter-btn" onclick="filterByLanguage('all')">ğŸ“– Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒØªØ¨</button>
            </div>
        </div>

        <!-- Authors & Categories Filters -->
        <div class="filters" id="dynamicFilters">
            <!-- Will be populated by JavaScript -->
        </div>

        <!-- Books Grid -->
        <div id="booksContainer">
            <div class="loading">
                <div class="spinner"></div>
                <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ¨...</p>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let allBooks = [];
        let allAuthors = [];
        let allCategories = [];
        let currentFilters = {
            language: 'ar',
            author: null,
            category: null,
            search: ''
        };

        // API Base URL
        const API_BASE = window.location.origin;

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await Promise.all([
                loadStats(),
                loadAuthors(),
                loadCategories(),
                loadBooks()
            ]);
            loadTheme();
        });

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/api/stats`);
                const data = await response.json();

                if (data.ok) {
                    document.getElementById('totalBooks').textContent = data.stats.books.total;
                    document.getElementById('arabicBooks').textContent = data.stats.books.arabic;
                    document.getElementById('totalPages').textContent = data.stats.pages.total.toLocaleString('ar-EG');
                    document.getElementById('totalAuthors').textContent = data.stats.authors.total;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load authors
        async function loadAuthors() {
            try {
                const response = await fetch(`${API_BASE}/api/authors?language=ar&limit=20`);
                const data = await response.json();

                if (data.ok) {
                    allAuthors = data.authors;
                    renderAuthorFilters();
                }
            } catch (error) {
                console.error('Error loading authors:', error);
            }
        }

        // Load categories
        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}/api/categories?language=ar&limit=20`);
                const data = await response.json();

                if (data.ok) {
                    allCategories = data.categories;
                    renderCategoryFilters();
                }
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        // Render author filters
        function renderAuthorFilters() {
            const container = document.getElementById('dynamicFilters');
            const authorGroup = document.createElement('div');
            authorGroup.className = 'filter-group';
            authorGroup.innerHTML = '<h4 style="width: 100%; color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¤Ù„Ù:</h4>';

            allAuthors.slice(0, 10).forEach(author => {
                const btn = document.createElement('button');
                btn.className = 'filter-btn';
                btn.textContent = `${author.name} (${author.book_count})`;
                btn.onclick = () => filterByAuthor(author.id);
                authorGroup.appendChild(btn);
            });

            container.appendChild(authorGroup);
        }

        // Render category filters
        function renderCategoryFilters() {
            const container = document.getElementById('dynamicFilters');
            const categoryGroup = document.createElement('div');
            categoryGroup.className = 'filter-group';
            categoryGroup.innerHTML = '<h4 style="width: 100%; color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem; margin-top: 1rem;">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹:</h4>';

            allCategories.slice(0, 10).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'filter-btn';
                btn.textContent = `${category.name} (${category.book_count})`;
                btn.onclick = () => filterByCategory(category.id);
                categoryGroup.appendChild(btn);
            });

            container.appendChild(categoryGroup);
        }

        // Load books
        async function loadBooks() {
            try {
                const params = new URLSearchParams();
                if (currentFilters.language && currentFilters.language !== 'all') {
                    params.append('language', currentFilters.language);
                }
                if (currentFilters.author) {
                    params.append('author_id', currentFilters.author);
                }
                if (currentFilters.category) {
                    params.append('category_id', currentFilters.category);
                }
                if (currentFilters.search) {
                    params.append('search', currentFilters.search);
                }
                params.append('limit', '50');

                const response = await fetch(`${API_BASE}/api/books?${params}`);
                const data = await response.json();

                if (data.ok) {
                    allBooks = data.books;
                    renderBooks(allBooks);
                }
            } catch (error) {
                console.error('Error loading books:', error);
                document.getElementById('booksContainer').innerHTML = `
                    <div class="empty-state">
                        <h3>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</h3>
                        <p>Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØªØ¨. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>
                    </div>
                `;
            }
        }

        // Render books
        function renderBooks(books) {
            const container = document.getElementById('booksContainer');

            if (books.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>ğŸ“š Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØªØ¨</h3>
                        <p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒØªØ¨ ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ.</p>
                    </div>
                `;
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'book-grid';

            books.forEach(book => {
                const card = createBookCard(book);
                grid.appendChild(card);
            });

            container.innerHTML = '';
            container.appendChild(grid);
        }

        // Create book card
        function createBookCard(book) {
            const card = document.createElement('div');
            card.className = 'book-card';
            card.onclick = () => openBook(book);

            const title = book.language === 'ar' ? book.title : book.title;
            const coverImage = book.cover_image_url
                ? `<img src="${book.cover_image_url}" alt="${title}">`
                : `<span class="placeholder">ğŸ“–</span>`;

            card.innerHTML = `
                <div class="book-cover">
                    ${coverImage}
                </div>
                <div class="book-info">
                    <h3>${title}</h3>
                    <div class="book-meta">
                        <span class="author">${book.author.name}</span>
                        ${book.category ? ` â€¢ ${book.category.name}` : ''}
                    </div>
                    <div class="book-tags">
                        <span class="tag language">${book.language === 'ar' ? 'Ø¹Ø±Ø¨ÙŠ' : 'English'}</span>
                        ${book.page_count ? `<span class="tag">${book.page_count} ØµÙØ­Ø©</span>` : ''}
                        ${book.section_count ? `<span class="tag">${book.section_count} ÙØµÙ„</span>` : ''}
                    </div>
                </div>
            `;

            return card;
        }

        // Open book
        function openBook(book) {
            if (book.html_url) {
                window.open(book.html_url, '_blank');
            } else {
                alert('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹');
            }
        }

        // Filter functions
        function filterByLanguage(lang) {
            currentFilters.language = lang;
            currentFilters.author = null;
            currentFilters.category = null;
            updateActiveFilters();
            loadBooks();
        }

        function filterByAuthor(authorId) {
            currentFilters.author = currentFilters.author === authorId ? null : authorId;
            updateActiveFilters();
            loadBooks();
        }

        function filterByCategory(categoryId) {
            currentFilters.category = currentFilters.category === categoryId ? null : categoryId;
            updateActiveFilters();
            loadBooks();
        }

        function updateActiveFilters() {
            // Update language buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        }

        // Search
        let searchTimeout;
        function handleSearch() {
            clearTimeout(searchTimeout);
            const query = document.getElementById('searchInput').value;

            searchTimeout = setTimeout(() => {
                currentFilters.search = query;
                loadBooks();
            }, 500);
        }

        // Theme toggle
        function toggleTheme() {
            const html = document.documentElement;
            const button = document.querySelector('.theme-toggle');

            if (html.getAttribute('data-theme') === 'dark') {
                html.removeAttribute('data-theme');
                button.textContent = 'ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ';
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                button.textContent = 'â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ';
                localStorage.setItem('theme', 'dark');
            }
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            const button = document.querySelector('.theme-toggle');

            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                button.textContent = 'â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ';
            }
        }

        // Language toggle
        function toggleLanguage() {
            const html = document.documentElement;
            const button = document.querySelector('.lang-switch');

            if (html.getAttribute('lang') === 'ar') {
                html.setAttribute('lang', 'en');
                html.setAttribute('dir', 'ltr');
                button.textContent = 'Ø¹Ø±Ø¨ÙŠ';
                // Update all Arabic text to English (implement based on needs)
            } else {
                html.setAttribute('lang', 'ar');
                html.setAttribute('dir', 'rtl');
                button.textContent = 'English';
            }
        }
    </script>
</body>
</html>
